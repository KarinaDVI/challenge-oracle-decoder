<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Document</title>
    <link rel="stylesheet" href="challenge1.css" />
  </head>
  <body>
    <header class="titulo">
      <div class="line">
          
          <h1><img src="Logo.png" alt="Alura">Encriptador</h1>
      </div>
    </header>
    <main>
      <div class="entrada">
        <div class="textos">
        <input
          id="mensaje"
          type="text"
          autofocus
          pattern="^[a-za-z-ñ\s]+$"
          placeholder="solo minusculas"/>
          
          <br>
        <div id="encriptado" >
        </div>
        <div id="advertencia"></div>
      </div>
        <div class="botonera">
          <button id="encriptar">Encriptar</button>
          <button id="desencriptar">Desencriptar</button>
          <button id="copiado">copiar</button>
          <br>
          <button id="limpiar"><img src="" alt="">Limpiar</button>
          
        </div>
      </div>
    </main>
    <footer>
      
      <div class="copyright">
        <p id="aviso"></p>
        <p>Made with love by Karina Beatriz Bouza</p>  
      </div>
    </footer>
  </body>

  <script>
    var input = document.getElementById("mensaje");
    var buttonEncriptar = document.getElementById("encriptar");
    buttonEncriptar.onclick = encriptar;
    var buttonDesencriptar = document.getElementById("desencriptar");
    buttonDesencriptar.onclick = desencriptar;
    var buttonCopiado = document.getElementById("copiado");
    buttonCopiado.onclick = copiar;
    var buttonLimpiar = document.getElementById("limpiar");
    buttonLimpiar.onclick = limpiar;
    var advertencia=document.getElementById("advertencia");

    arrVocal = ["a", "e", "i", "o", "u"];
    arrReplace = ["ai", "enter", "imes", "ober", "ufat"];

    function encriptar() {
      var mensajeIngresar = input.value;
      var mEncriptado = "";

      if (!input.checkValidity()) {
        advertencia.innerText="Ingresa solo letras minúsculas.";
        document.getElementById("mensaje").value="";
      } else if(mensajeIngresar.length==0){
        advertencia.innerText="Texto no encontrado; Ingrese texto para encriptar";
      }
      else {
        for (let i = 0; i < mensajeIngresar.length; i++) {
          let flag = 0;
          let pos;
          for (let j = 0; j < 5; j++) {
            if (mensajeIngresar[i] == arrVocal[j]) {
              flag = 1;
              pos = j;
              break;
            }
          }
          if (flag == 1) {
            mEncriptado = mEncriptado + arrReplace[pos];
          }
          if (flag == 0) {
            mEncriptado = mEncriptado + mensajeIngresar[i];
          }
        }
        //Setear el text area para mostrar el mensaje encriptado;
        document.getElementById("encriptado").innerHTML = mEncriptado;
        //Vaciar el aviso de copiado
        document.getElementById("aviso").innerText="";
        advertencia.innerText="";
      }
    }

    // A partir de aquí, la selva....

    function desencriptar() {
      var textArea = document.getElementById("mensaje");
      var tEncriptado = textArea.value;
      var desencriptado = "";
      console.log("a desencriptar: " + tEncriptado);

      if (!input.checkValidity()) {
        advertencia.innerText="Ingresa solo letras minúsculas.";
        document.getElementById("mensaje").value="";
      } else if(tEncriptado.length==0){
        advertencia.innerText="Texto no encontrado; Ingrese texto para desencriptar";
      }
      else {
      for (let i = 0; i < tEncriptado.length; i++) {
        let flag = 0;
        let pos;
        for (let j = 0; j < 5; j++) {
          if (tEncriptado[i] == arrVocal[j]) {
            flag = 1;
            pos = j;
            break;
          }
        }

        if (flag == 1) {
          let bit = arrReplace[pos].toString();
          let part = tEncriptado.substring(i, i + bit.length);

          //console.log("part: "+part+" "+"i, bit.length: "+i+" , "+bit.length);
          if (part == arrReplace[pos]) {
            desencriptado = desencriptado + arrVocal[pos];
            i = i + arrReplace[pos].length - 1;
            //console.log(i);
          }
        }
        if (flag == 0) {
          desencriptado = desencriptado + tEncriptado[i];
          //console.log(i);
        }
      }

      //Setear el text area para mostrar el mensaje encriptado;
      document.getElementById("encriptado").innerHTML = desencriptado;
      //Vaciar el aviso de copiado
      document.getElementById("aviso").innerText="";
      advertencia.innerText="";
    }
    }

    function copiar() {
      /* Obtiene el texto */
      var copyText = document.getElementById("encriptado");
      var text = copyText.innerHTML;
      document.getElementById("mensaje").value = text;

        if (document.getElementById("encriptado").innerText==""){
          advertencia.innerText="No hay nada para copiar";
        }else{

      /* Selecciona el campo de texto 
      copyText.select();
      copyText.setSelectionRange(0, 99999); /* For mobile devices */
      /* Copia el texto desde el campo de texto */
      navigator.clipboard.writeText(text);
      /* Avisa el copiado */
      document.getElementById("aviso").innerHTML="Copiado al input y al portapapeles"
      advertencia.innerText="";
    }
  }
  
    function limpiar(){
      document.getElementById("mensaje").value = "";
      document.getElementById("encriptado").innerHTML = "";
      document.getElementById("aviso").innerText="";
      advertencia.innerText="";

    }
  </script>
</html>
